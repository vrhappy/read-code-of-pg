<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="716px" preserveAspectRatio="none" style="width:1196px;height:716px;" version="1.1" viewBox="0 0 1196 716" width="1196px" zoomAndPan="magnify"><defs><filter height="300%" id="fyy5zxg9nqnpa" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="121.5" cy="16" fill="#000000" filter="url(#fyy5zxg9nqnpa)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><g id="FTS_SYNCREP_OFF_SEGMENT"><rect fill="#FEFECE" filter="url(#fyy5zxg9nqnpa)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="229" x="7" y="314"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7" x2="236" y1="340.2969" y2="340.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="209" x="17" y="331.9951">FTS_SYNCREP_OFF_SEGMENT</text></g><g id="FTS_SYNCREP_OFF_FAIL"><rect fill="#FEFECE" filter="url(#fyy5zxg9nqnpa)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="190" x="638.5" y="314"/><line style="stroke:#A80036;stroke-width:1.5;" x1="638.5" x2="828.5" y1="340.2969" y2="340.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="170" x="648.5" y="331.9951">FTS_SYNCREP_OFF_FAIL</text></g><g id="FTS_SYNCREP_OFF_SUCCESS"><rect fill="#FEFECE" filter="url(#fyy5zxg9nqnpa)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="225" x="957" y="314"/><line style="stroke:#A80036;stroke-width:1.5;" x1="957" x2="1182" y1="340.2969" y2="340.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="205" x="967" y="331.9951">FTS_SYNCREP_OFF_SUCCESS</text></g><ellipse cx="870.5" cy="677" filter="url(#fyy5zxg9nqnpa)" rx="10" ry="10" style="stroke:#000000;stroke-width:1.0;fill:none;"/><ellipse cx="871" cy="677.5" fill="#000000" rx="6" ry="6" style="stroke:none;stroke-width:1.0;"/><g id="FTS_SYNCREP_OFF_WAIT"><rect fill="#FEFECE" filter="url(#fyy5zxg9nqnpa)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="197" x="497" y="652"/><line style="stroke:#A80036;stroke-width:1.5;" x1="497" x2="694" y1="678.2969" y2="678.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="177" x="507" y="669.9951">FTS_SYNCREP_OFF_WAIT</text></g><rect fill="#FEFECE" filter="url(#fyy5zxg9nqnpa)" height="472.1875" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="239.5" x="271.5" y="103"/><rect fill="#FFFFFF" height="423.5938" rx="12.5" ry="12.5" style="stroke:#FFFFFF;stroke-width:1.0;" width="233.5" x="274.5" y="148.5938"/><line style="stroke:#A80036;stroke-width:1.5;" x1="271.5" x2="511" y1="145.5938" y2="145.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="203" x="289.75" y="120.9951">Communicate with segment</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="363.75" y="137.292">by libpq</text><g id="StateSocket.long1"><rect fill="#FEFECE" filter="url(#fyy5zxg9nqnpa)" height="64.2344" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="168" x="292.5" y="213.5938"/><line style="stroke:#A80036;stroke-width:1.5;" x1="292.5" x2="460.5" y1="239.8906" y2="239.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="331" y="231.5889">ftsConnect()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="148" x="297.5" y="256.0293">"create libpq connection</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="86" x="301.5" y="269.998">with segment"</text></g><ellipse cx="376.5" cy="166.5938" fill="#000000" filter="url(#fyy5zxg9nqnpa)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><g id="StateSocket.poll"><rect fill="#FEFECE" filter="url(#fyy5zxg9nqnpa)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="76" x="338.5" y="314.5938"/><line style="stroke:#A80036;stroke-width:1.5;" x1="338.5" x2="414.5" y1="340.8906" y2="340.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="348.5" y="332.5889">ftsPoll()</text></g><g id="StateSocket.update"><rect fill="#FEFECE" filter="url(#fyy5zxg9nqnpa)" height="52.5938" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="127" x="368" y="504.5938"/><line style="stroke:#A80036;stroke-width:1.5;" x1="368" x2="495" y1="547.1875" y2="547.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="378" y="522.5889">update ftsInfo</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="382.5" y="538.8857">with message</text></g><g id="StateSocket.ftsSend"><rect fill="#FEFECE" filter="url(#fyy5zxg9nqnpa)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="76" x="283.5" y="417.5938"/><line style="stroke:#A80036;stroke-width:1.5;" x1="283.5" x2="359.5" y1="443.8906" y2="443.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="293.5" y="435.5889">ftsSend</text></g><g id="StateSocket.ftsReceive"><rect fill="#FEFECE" filter="url(#fyy5zxg9nqnpa)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="97" x="383" y="417.5938"/><line style="stroke:#A80036;stroke-width:1.5;" x1="383" x2="480" y1="443.8906" y2="443.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="393" y="435.5889">ftsReceive</text></g><!--MD5=[dd6ad9b365bf2b3bdf74e95741d5e7fd]
link *start*StateSocket to long1--><path d="M376.5,176.7288 C376.5,184.6768 376.5,196.7338 376.5,208.4928 " fill="none" id="*start*StateSocket-to-long1" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="376.5,213.5007,380.5,204.5007,376.5,208.5007,372.5,204.5007,376.5,213.5007" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[ab72e750f024c3b94e0bda2ddbc5ba52]
link long1 to poll--><path d="M376.5,277.7408 C376.5,287.9508 376.5,299.2538 376.5,309.3208 " fill="none" id="long1-to-poll" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="376.5,314.4598,380.5,305.4598,376.5,309.4598,372.5,305.4598,376.5,314.4598" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[dfabde42eccabfe07b084b6028be8246]
link poll to ftsSend--><path d="M338.2891,363.1118 C331.937,368.6468 326.2158,375.1568 322.5,382.5938 C317.977,391.6468 316.7957,402.4978 317.0506,412.4108 " fill="none" id="poll-to-ftsSend" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="317.3047,417.4958,320.8523,408.308,317.0561,412.5019,312.8622,408.7057,317.3047,417.4958" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="323.5" y="395.6606">if write ready</text><!--MD5=[5f20784d7a0efc504bcbadc413bf6ea7]
link poll to ftsReceive--><path d="M397.729,365.0208 C401.967,370.5757 406.141,376.6097 409.5,382.5938 C414.788,392.0148 419.272,402.9557 422.784,412.8378 " fill="none" id="poll-to-ftsReceive" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="424.43,417.5928,425.2652,407.7794,422.7941,412.8679,417.7055,410.3968,424.43,417.5928" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="418.5" y="395.6606">if read ready</text><!--MD5=[a994e953120ce7c642eef577ec1770fd]
link ftsReceive to update--><path d="M431.5,467.6889 C431.5,477.4837 431.5,488.9211 431.5,499.3094 " fill="none" id="ftsReceive-to-update" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="431.5,504.313,435.5,495.313,431.5,499.313,427.5,495.313,431.5,504.313" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[9e02c5e0f4da8fd4946a2dee6e27ab97]
link *start to FTS_SYNCREP_OFF_SEGMENT--><path d="M121.5,26.261 C121.5,67.938 121.5,239.088 121.5,308.525 " fill="none" id="*start-to-FTS_SYNCREP_OFF_SEGMENT" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="121.5,313.741,125.5,304.741,121.5,308.741,117.5,304.741,121.5,313.741" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="122.5" y="69.0669">start SYNCREP_OFF</text><!--MD5=[a93f0182c522d48c2ab37900439d9682]
link FTS_SYNCREP_OFF_SEGMENT to StateSocket--><path d="M236.197,339 C246.185,339 256.173,339 266.16,339 " fill="none" id="FTS_SYNCREP_OFF_SEGMENT-to-StateSocket" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="271.383,339,262.383,335,266.383,339,262.383,343,271.383,339" style="stroke:#000000;stroke-width:1.0;"/><!--MD5=[8e049142902d4c809f0886cc295d66cd]
link StateSocket to FTS_SYNCREP_OFF_FAIL--><path d="M511.596,339 C551.382,339 595.215,339 633.34,339 " fill="none" id="StateSocket-to-FTS_SYNCREP_OFF_FAIL" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="638.44,339,629.44,335,633.44,339,629.44,343,638.44,339" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="530" y="317.0669">connect/send/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="532" y="332.1997">receive failed</text><!--MD5=[04d0e509cdf8be724f3eeb5f905b9d38]
link StateSocket to FTS_SYNCREP_OFF_SUCCESS--><path d="M511.804,161.298 C547.734,122.172 590.631,86.015 639,64.5 C696.461,38.94 868.023,32.228 922,64.5 C1012.37,118.532 1050.59,249.066 1063.71,308.55 " fill="none" id="StateSocket-to-FTS_SYNCREP_OFF_SUCCESS" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="1064.84,313.738,1066.8489,304.0962,1063.784,308.8508,1059.0294,305.7859,1064.84,313.738" style="stroke:#000000;stroke-width:1.0;"/><!--MD5=[c08c325a8a656aa7a336a748615fdeaf]
link FTS_SYNCREP_OFF_SUCCESS to *end--><path d="M1057.13,364.107 C1034.82,407.155 985.856,499.783 939.5,575 C919.06,608.1655 892.481,645.6643 879.059,664.2542 " fill="none" id="FTS_SYNCREP_OFF_SUCCESS-to-*end" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="875.941,668.5589,884.4601,663.6168,878.8742,664.5097,877.9814,658.9237,875.941,668.5589" style="stroke:#000000;stroke-width:1.0;"/><!--MD5=[b48c24c3f1913e8e7c087cc71251e084]
link FTS_SYNCREP_OFF_FAIL to FTS_SYNCREP_OFF_WAIT--><path d="M723.575,364.164 C698.82,424.438 634.408,581.268 607.542,646.6803 " fill="none" id="FTS_SYNCREP_OFF_FAIL-to-FTS_SYNCREP_OFF_WAIT" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="605.52,651.6032,612.6392,644.7975,607.4195,646.9781,605.2389,641.7584,605.52,651.6032" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="622.5" y="618.0669">retry_count++</text><!--MD5=[d91c6b4948a23b0cb7c3828ce0ab9927]
link FTS_SYNCREP_OFF_WAIT to FTS_SYNCREP_OFF_SEGMENT--><path d="M496.806,666.891 C423.05,655.6733 323.328,630.6731 253.5,575 C184.698,520.145 145.751,419.083 129.922,369.292 " fill="none" id="FTS_SYNCREP_OFF_WAIT-to-FTS_SYNCREP_OFF_SEGMENT" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="128.373,364.347,127.2482,374.1314,129.8686,369.1181,134.8819,371.7385,128.373,364.347" style="stroke:#000000;stroke-width:1.0;"/><!--MD5=[509bd2abee8cde61d56ecf02ea5f44d6]
link FTS_SYNCREP_OFF_FAIL to FTS_SYNCREP_OFF_FAIL--><path d="M754.301,313.878 C799.785,271.893 863.5,280.267 863.5,339 C863.5,396.127 803.222,405.612 758.071,367.453 " fill="none" id="FTS_SYNCREP_OFF_FAIL-to-FTS_SYNCREP_OFF_FAIL" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="754.301,364.122,758.3962,373.0791,758.0476,367.433,763.6938,367.0845,754.301,364.122" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31" x="883.5" y="336.0669">retry</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="869.5" y="351.1997">exhaused</text><!--MD5=[0eb38c8adb2089c7fbc9facadbd48780]
link FTS_SYNCREP_OFF_FAIL to *end--><path d="M743.353,364.164 C770.282,430.21 844.483,612.1924 865.115,662.7931 " fill="none" id="FTS_SYNCREP_OFF_FAIL-to-*end" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="867.047,667.5316,867.3529,657.6875,865.1592,662.9017,859.945,660.708,867.047,667.5316" style="stroke:#000000;stroke-width:1.0;"/><!--MD5=[0a5496e04582f58c50a5ddd1909b7067]
@startuml
[*] - -> FTS_SYNCREP_OFF_SEGMENT : start SYNCREP_OFF
FTS_SYNCREP_OFF_SEGMENT -right[#black]-> StateSocket
StateSocket -[#black]> FTS_SYNCREP_OFF_FAIL : connect/send/\nreceive failed
StateSocket -[#black]> FTS_SYNCREP_OFF_SUCCESS
FTS_SYNCREP_OFF_SUCCESS -[#black]-> [*]
FTS_SYNCREP_OFF_FAIL -[#black]-> FTS_SYNCREP_OFF_WAIT : retry_count++
FTS_SYNCREP_OFF_WAIT -[#black]-> FTS_SYNCREP_OFF_SEGMENT
FTS_SYNCREP_OFF_FAIL -[#black]> FTS_SYNCREP_OFF_FAIL : retry \nexhaused
FTS_SYNCREP_OFF_FAIL -[#black]-> [*]

state "Communicate with segment\n by libpq" as StateSocket {
  state "ftsConnect()" as long1
  long1 : "create libpq connection\n with segment"
  [*] - -> long1
  state "ftsPoll()" as poll
  state "update ftsInfo \nwith message" as update
  long1 -down-> poll
  poll - -> ftsSend : if write ready
  poll - -> ftsReceive : if read ready
  ftsReceive -down-> update
}
@enduml

PlantUML version 1.2021.4(Sun Apr 04 08:49:39 UTC 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>