<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="634px" preserveAspectRatio="none" style="width:741px;height:634px;" version="1.1" viewBox="0 0 741 634" width="741px" zoomAndPan="magnify"><defs><filter height="300%" id="f1fxz8neq4ykp5" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="222" x="260" y="32.6279">fts probe sequence diagram</text><rect fill="#FFFFFF" filter="url(#f1fxz8neq4ykp5)" height="354.1553" style="stroke:#A80036;stroke-width:1.0;" width="10" x="576.5" y="208.9663"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="146" x2="146" y1="81.7031" y2="588.1216"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="370.5" x2="370.5" y1="81.7031" y2="588.1216"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="581.5" x2="581.5" y1="209.272" y2="588.1216"/><rect fill="#FEFECE" filter="url(#f1fxz8neq4ykp5)" height="33.1201" style="stroke:#A80036;stroke-width:1.5;" width="83" x="103" y="43.583"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="110" y="66.627">fts process</text><rect fill="#FEFECE" filter="url(#f1fxz8neq4ykp5)" height="33.1201" style="stroke:#A80036;stroke-width:1.5;" width="83" x="103" y="587.1216"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="110" y="610.1655">fts process</text><rect fill="#FEFECE" filter="url(#f1fxz8neq4ykp5)" height="33.1201" style="stroke:#A80036;stroke-width:1.5;" width="142" x="297.5" y="43.583"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="304.5" y="66.627">segment postmaster</text><rect fill="#FEFECE" filter="url(#f1fxz8neq4ykp5)" height="33.1201" style="stroke:#A80036;stroke-width:1.5;" width="142" x="297.5" y="587.1216"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="304.5" y="610.1655">segment postmaster</text><rect fill="#FEFECE" filter="url(#f1fxz8neq4ykp5)" height="33.1201" style="stroke:#A80036;stroke-width:1.5;" width="122" x="518.5" y="587.1216"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="525.5" y="610.1655">backend process</text><rect fill="#FFFFFF" filter="url(#f1fxz8neq4ykp5)" height="354.1553" style="stroke:#A80036;stroke-width:1.0;" width="10" x="576.5" y="208.9663"/><polygon fill="#A80036" points="358.5,116.4575,368.5,120.4575,358.5,124.4575,362.5,120.4575" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="146.5" x2="364.5" y1="120.4575" y2="120.4575"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200" x="153.5" y="115.6011">send create pq connection request</text><path d="M46,96.7031 L46,123.7031 L137,123.7031 L137,106.7031 L127,96.7031 L46,96.7031 " fill="#FBFB77" filter="url(#f1fxz8neq4ykp5)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M127,96.7031 L127,106.7031 L137,106.7031 L127,96.7031 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="52" y="116.6011">ftsConnect()</text><path d="M151,138.4575 L151,165.4575 L510,165.4575 L510,148.4575 L500,138.4575 L151,138.4575 " fill="#FBFB77" filter="url(#f1fxz8neq4ykp5)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M500,138.4575 L500,148.4575 L510,148.4575 L500,138.4575 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="338" x="157" y="158.3555">"...7p...user ssadmin database postgres gpconntype fts..."</text><polygon fill="#A80036" points="506.5,194.9663,516.5,198.9663,506.5,202.9663,510.5,198.9663" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="370.5" x2="512.5" y1="198.9663" y2="198.9663"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="377.5" y="194.1099">fork backend process</text><rect fill="#FEFECE" filter="url(#f1fxz8neq4ykp5)" height="33.1201" style="stroke:#A80036;stroke-width:1.5;" width="122" x="518.5" y="175.2119"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="525.5" y="198.2559">backend process</text><polygon fill="#A80036" points="157.5,248.0864,147.5,252.0864,157.5,256.0864,153.5,252.0864" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="151.5" x2="575.5" y1="252.0864" y2="252.0864"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="163.5" y="247.23">connected ok</text><path d="M72,228.332 L72,255.332 L137,255.332 L137,238.332 L127,228.332 L72,228.332 " fill="#FBFB77" filter="url(#f1fxz8neq4ykp5)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M127,228.332 L127,238.332 L137,238.332 L127,228.332 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44" x="78" y="248.23">ftsPoll()</text><polygon fill="#A80036" points="564.5,289.8408,574.5,293.8408,564.5,297.8408,568.5,293.8408" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="146.5" x2="570.5" y1="293.8408" y2="293.8408"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="254" x="153.5" y="288.9844">if socket is writable, send PROBE message</text><path d="M64,270.0864 L64,297.0864 L137,297.0864 L137,280.0864 L127,270.0864 L64,270.0864 " fill="#FBFB77" filter="url(#f1fxz8neq4ykp5)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M127,270.0864 L127,280.0864 L137,280.0864 L127,270.0864 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="70" y="289.9844">ftsSend()</text><path d="M151,311.8408 L151,338.8408 L361,338.8408 L361,321.8408 L351,311.8408 L151,311.8408 " fill="#FBFB77" filter="url(#f1fxz8neq4ykp5)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M351,311.8408 L351,321.8408 L361,321.8408 L351,311.8408 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="157" y="331.7388">Q...PROBE dbid=%d contid=%d</text><polygon fill="#A80036" points="157.5,378.3496,147.5,382.3496,157.5,386.3496,153.5,382.3496" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="151.5" x2="575.5" y1="382.3496" y2="382.3496"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265" x="163.5" y="377.4932">response the information of primary and mirror</text><path d="M591,353.5952 L591,380.5952 L732,380.5952 L732,363.5952 L722,353.5952 L591,353.5952 " fill="#FBFB77" filter="url(#f1fxz8neq4ykp5)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M722,353.5952 L722,363.5952 L732,363.5952 L722,353.5952 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="597" y="373.4932">HandleFtsMessage()</text><path d="M49,353.5952 L49,380.5952 L137,380.5952 L137,363.5952 L127,353.5952 L49,353.5952 " fill="#FBFB77" filter="url(#f1fxz8neq4ykp5)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M127,353.5952 L127,363.5952 L137,363.5952 L127,353.5952 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="55" y="373.4932">ftsReceive()</text><path d="M226,395.3496 L226,440.3496 L567,440.3496 L567,405.3496 L557,395.3496 L226,395.3496 " fill="#FBFB77" filter="url(#f1fxz8neq4ykp5)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M557,395.3496 L557,405.3496 L567,405.3496 L557,395.3496 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="320" x="232" y="415.2476">T...is_mirror_up...is_in_sync...is_syncrep_enabled...is_</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="232" y="433.002">role_mirror...request_retry...D...</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="37" x="414" y="433.002">values</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="451" y="433.002">...PROBE.Z...</text><polygon fill="#A80036" points="564.5,474.6128,574.5,478.6128,564.5,482.6128,568.5,478.6128" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="146.5" x2="570.5" y1="478.6128" y2="478.6128"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="153.5" y="473.7563">close the pq connection</text><path d="M5,454.8584 L5,481.8584 L138,481.8584 L138,464.8584 L128,454.8584 L5,454.8584 " fill="#FBFB77" filter="url(#f1fxz8neq4ykp5)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M128,454.8584 L128,464.8584 L138,464.8584 L128,454.8584 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="11" y="474.7563">processResponse()</text><path d="M151,496.6128 L151,523.6128 L191,523.6128 L191,506.6128 L181,496.6128 L151,496.6128 " fill="#FBFB77" filter="url(#f1fxz8neq4ykp5)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M181,496.6128 L181,506.6128 L191,506.6128 L181,496.6128 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="19" x="157" y="516.5107">X...</text><line style="stroke:#A80036;stroke-width:1.0;" x1="586.5" x2="628.5" y1="557.1216" y2="557.1216"/><line style="stroke:#A80036;stroke-width:1.0;" x1="628.5" x2="628.5" y1="557.1216" y2="570.1216"/><line style="stroke:#A80036;stroke-width:1.0;" x1="587.5" x2="628.5" y1="570.1216" y2="570.1216"/><polygon fill="#A80036" points="597.5,566.1216,587.5,570.1216,597.5,574.1216,593.5,570.1216" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="593.5" y="552.2651">process exit</text><line style="stroke:#A80036;stroke-width:2.0;" x1="572.5" x2="590.5" y1="561.1216" y2="579.1216"/><line style="stroke:#A80036;stroke-width:2.0;" x1="572.5" x2="590.5" y1="579.1216" y2="561.1216"/><!--MD5=[6954142f8d3dd5e76535fff7ae8f2914]
@startuml
title fts probe sequence diagram 

participant "fts process" as fts
participant "segment postmaster" as segment

fts -> segment : send create pq connection request
note left : ftsConnect()
note right fts 
"...7p...user ssadmin database postgres gpconntype fts..."
end note

create participant "backend process" as backend
segment -> backend ++ : fork backend process
backend - -> fts : connected ok

note left : ftsPoll()
fts -> backend : if socket is writable, send PROBE message
note left : ftsSend()
note right fts : Q...PROBE dbid=%d contid=%d

backend - -> fts : response the information of primary and mirror
note right : HandleFtsMessage()
note left backend
T...is_mirror_up...is_in_sync...is_syncrep_enabled...is_
role_mirror...request_retry...D...//values//...PROBE.Z...
end note
note left : ftsReceive()

fts -> backend : close the pq connection
note left : processResponse()
note right fts : X...
backend -> backend !! : process exit

@enduml

PlantUML version 1.2021.00(Sun Jan 10 18:25:05 CST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg>