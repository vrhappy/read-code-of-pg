<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="843px" preserveAspectRatio="none" style="width:796px;height:843px;" version="1.1" viewBox="0 0 796 843" width="796px" zoomAndPan="magnify"><defs><filter height="300%" id="ffkvyntvafeyw" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="122.2962" cy="16" fill="#000000" filter="url(#ffkvyntvafeyw)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><g id="FTS_PROMOTE_SEGMENT"><rect fill="#FEFECE" filter="url(#ffkvyntvafeyw)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="200" x="22.2962" y="314"/><line style="stroke:#A80036;stroke-width:1.5;" x1="22.2962" x2="222.2962" y1="340.2969" y2="340.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="180" x="32.2962" y="331.9951">FTS_PROMOTE_SEGMENT</text></g><g id="FTS_PROMOTE_SUCCESS"><rect fill="#FEFECE" filter="url(#ffkvyntvafeyw)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="196" x="586.2962" y="652"/><line style="stroke:#A80036;stroke-width:1.5;" x1="586.2962" x2="782.2962" y1="678.2969" y2="678.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176" x="596.2962" y="669.9951">FTS_PROMOTE_SUCCESS</text></g><g id="FTS_PROBE_SUCCESS"><rect fill="#FEFECE" filter="url(#ffkvyntvafeyw)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="174" x="87.2962" y="652"/><line style="stroke:#A80036;stroke-width:1.5;" x1="87.2962" x2="261.2962" y1="678.2969" y2="678.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="97.2962" y="669.9951">FTS_PROBE_SUCCESS</text></g><ellipse cx="510.2962" cy="804" filter="url(#ffkvyntvafeyw)" rx="10" ry="10" style="stroke:#000000;stroke-width:1.0;fill:none;"/><ellipse cx="510.7962" cy="804.5" fill="#000000" rx="6" ry="6" style="stroke:none;stroke-width:1.0;"/><g id="FTS_PROMOTE_FAIL"><rect fill="#FEFECE" filter="url(#ffkvyntvafeyw)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="161" x="296.7962" y="652"/><line style="stroke:#A80036;stroke-width:1.5;" x1="296.7962" x2="457.7962" y1="678.2969" y2="678.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="141" x="306.7962" y="669.9951">FTS_PROMOTE_FAIL</text></g><g id="FTS_PROMOTE_WAIT"><rect fill="#FEFECE" filter="url(#ffkvyntvafeyw)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="168" x="159.2962" y="779"/><line style="stroke:#A80036;stroke-width:1.5;" x1="159.2962" x2="327.2962" y1="805.2969" y2="805.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="148" x="169.2962" y="796.9951">FTS_PROMOTE_WAIT</text></g><rect fill="#FEFECE" filter="url(#ffkvyntvafeyw)" height="472.1875" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="239.5" x="257.2962" y="103"/><rect fill="#FFFFFF" height="423.5938" rx="12.5" ry="12.5" style="stroke:#FFFFFF;stroke-width:1.0;" width="233.5" x="260.2962" y="148.5938"/><line style="stroke:#A80036;stroke-width:1.5;" x1="257.2962" x2="496.7962" y1="145.5938" y2="145.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="203" x="275.5462" y="120.9951">Communicate with segment</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="349.5462" y="137.292">by libpq</text><g id="StateSocket.long1"><rect fill="#FEFECE" filter="url(#ffkvyntvafeyw)" height="64.2344" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="168" x="278.2962" y="213.5938"/><line style="stroke:#A80036;stroke-width:1.5;" x1="278.2962" x2="446.2962" y1="239.8906" y2="239.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="316.7962" y="231.5889">ftsConnect()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="148" x="283.2962" y="256.0293">"create libpq connection</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="86" x="287.2962" y="269.998">with segment"</text></g><ellipse cx="362.2962" cy="166.5938" fill="#000000" filter="url(#ffkvyntvafeyw)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><g id="StateSocket.poll"><rect fill="#FEFECE" filter="url(#ffkvyntvafeyw)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="76" x="324.2962" y="314.5938"/><line style="stroke:#A80036;stroke-width:1.5;" x1="324.2962" x2="400.2962" y1="340.8906" y2="340.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="334.2962" y="332.5889">ftsPoll()</text></g><g id="StateSocket.update"><rect fill="#FEFECE" filter="url(#ffkvyntvafeyw)" height="52.5938" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="127" x="353.7962" y="504.5938"/><line style="stroke:#A80036;stroke-width:1.5;" x1="353.7962" x2="480.7962" y1="547.1875" y2="547.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="363.7962" y="522.5889">update ftsInfo</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="368.2962" y="538.8857">with message</text></g><g id="StateSocket.ftsSend"><rect fill="#FEFECE" filter="url(#ffkvyntvafeyw)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="76" x="269.2962" y="417.5938"/><line style="stroke:#A80036;stroke-width:1.5;" x1="269.2962" x2="345.2962" y1="443.8906" y2="443.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="279.2962" y="435.5889">ftsSend</text></g><g id="StateSocket.ftsReceive"><rect fill="#FEFECE" filter="url(#ffkvyntvafeyw)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="97" x="368.7962" y="417.5938"/><line style="stroke:#A80036;stroke-width:1.5;" x1="368.7962" x2="465.7962" y1="443.8906" y2="443.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="378.7962" y="435.5889">ftsReceive</text></g><!--MD5=[dd6ad9b365bf2b3bdf74e95741d5e7fd]
link *start*StateSocket to long1--><path d="M362.2962,176.7288 C362.2962,184.6768 362.2962,196.7338 362.2962,208.4928 " fill="none" id="*start*StateSocket-to-long1" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="362.2962,213.5007,366.2962,204.5007,362.2962,208.5007,358.2962,204.5007,362.2962,213.5007" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[ab72e750f024c3b94e0bda2ddbc5ba52]
link long1 to poll--><path d="M362.2962,277.7408 C362.2962,287.9508 362.2962,299.2538 362.2962,309.3208 " fill="none" id="long1-to-poll" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="362.2962,314.4598,366.2962,305.4598,362.2962,309.4598,358.2962,305.4598,362.2962,314.4598" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[dfabde42eccabfe07b084b6028be8246]
link poll to ftsSend--><path d="M324.0853,363.1118 C317.7332,368.6468 312.012,375.1568 308.2962,382.5938 C303.7732,391.6468 302.5919,402.4978 302.8468,412.4108 " fill="none" id="poll-to-ftsSend" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="303.1009,417.4958,306.6485,408.308,302.8523,412.5019,298.6584,408.7057,303.1009,417.4958" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="309.2962" y="395.6606">if write ready</text><!--MD5=[5f20784d7a0efc504bcbadc413bf6ea7]
link poll to ftsReceive--><path d="M383.5252,365.0208 C387.7632,370.5757 391.9372,376.6097 395.2962,382.5938 C400.5842,392.0148 405.0682,402.9557 408.5802,412.8378 " fill="none" id="poll-to-ftsReceive" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="410.2262,417.5928,411.0614,407.7794,408.5903,412.8679,403.5017,410.3968,410.2262,417.5928" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="404.2962" y="395.6606">if read ready</text><!--MD5=[a994e953120ce7c642eef577ec1770fd]
link ftsReceive to update--><path d="M417.2962,467.6889 C417.2962,477.4837 417.2962,488.9211 417.2962,499.3094 " fill="none" id="ftsReceive-to-update" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="417.2962,504.313,421.2962,495.313,417.2962,499.313,413.2962,495.313,417.2962,504.313" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[526af28e7c829c00e8ed5bf85985f2e2]
link *start to FTS_PROMOTE_SEGMENT--><path d="M122.2962,26.261 C122.2962,67.938 122.2962,239.088 122.2962,308.525 " fill="none" id="*start-to-FTS_PROMOTE_SEGMENT" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="122.2962,313.741,126.2962,304.741,122.2962,308.741,118.2962,304.741,122.2962,313.741" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="123.2962" y="69.0669">start PROMOTE</text><!--MD5=[4394866495e38802329dcca59a90dafb]
link FTS_PROMOTE_SEGMENT to StateSocket--><path d="M222.4032,339 C232.2792,339 242.1542,339 252.0302,339 " fill="none" id="FTS_PROMOTE_SEGMENT-to-StateSocket" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="257.1942,339,248.1942,335,252.1942,339,248.1942,343,257.1942,339" style="stroke:#0000FF;stroke-width:1.0;"/><!--MD5=[777deebd8237b52cd45cfb4af42b5bd9]
link StateSocket to FTS_PROMOTE_SUCCESS--><path d="M497.3092,471.35 C556.5342,536.17 622.7512,608.641 658.3212,647.572 " fill="none" id="StateSocket-to-FTS_PROMOTE_SUCCESS" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="662.0862,651.692,658.9684,642.3497,658.7135,648.0008,653.0624,647.7459,662.0862,651.692" style="stroke:#0000FF;stroke-width:1.0;"/><!--MD5=[145d4df21e465dcd3db8f48517e62d58]
link StateSocket to FTS_PROBE_SUCCESS--><path d="M257.1652,555.764 C243.4442,578.378 229.3352,600.823 215.2962,622 C209.6982,630.444 203.2312,639.313 197.1112,647.368 " fill="none" id="StateSocket-to-FTS_PROBE_SUCCESS" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="193.7542,651.751,202.4026,647.0387,196.7947,647.7817,196.0517,642.1739,193.7542,651.751" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="226.2962" y="618.0669">role is mirror</text><!--MD5=[6de89343412f6c1515632f073647e0c1]
link FTS_PROMOTE_SUCCESS to *end--><path d="M650.7472,702.101 C611.3522,730.4025 548.0832,775.8544 522.0582,794.5506 " fill="none" id="FTS_PROMOTE_SUCCESS-to-*end" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="517.9272,797.5183,527.5704,795.5161,521.988,794.6012,522.903,789.0188,517.9272,797.5183" style="stroke:#0000FF;stroke-width:1.0;"/><!--MD5=[55d739042b6c519300598f3f0c9c9a8b]
link StateSocket to FTS_PROMOTE_FAIL--><path d="M377.2962,575.189 C377.2962,603.175 377.2962,628.182 377.2962,646.29 " fill="none" id="StateSocket-to-FTS_PROMOTE_FAIL" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="377.2962,651.684,381.2962,642.684,377.2962,646.684,373.2962,642.684,377.2962,651.684" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="378.2962" y="618.0669">connect/send/receive failed</text><!--MD5=[14532e7b7a15cfb082295e4a93ac279c]
link FTS_PROMOTE_FAIL to FTS_PROMOTE_WAIT--><path d="M351.4592,702.101 C328.9362,723.112 296.2802,753.575 272.7492,775.5256 " fill="none" id="FTS_PROMOTE_FAIL-to-FTS_PROMOTE_WAIT" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="269.0532,778.9727,278.3632,775.7595,272.7097,775.5625,272.9068,769.909,269.0532,778.9727" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="320.2962" y="745.0669">retry_count++</text><!--MD5=[613824e9590bd58f4198ab67d5088cb5]
link FTS_PROMOTE_WAIT to FTS_PROMOTE_SEGMENT--><path d="M166.7612,778.9177 C130.4112,763.1928 90.3854,738.626 69.2962,702 C6,592.072 73.7132,433.355 106.5533,368.868 " fill="none" id="FTS_PROMOTE_WAIT-to-FTS_PROMOTE_SEGMENT" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="108.8552,364.389,101.1833,370.5649,106.5694,368.8359,108.2984,374.2221,108.8552,364.389" style="stroke:#0000FF;stroke-width:1.0;"/><!--MD5=[b53cd190e146cfbafed72d38ef7aa16f]
link FTS_PROMOTE_FAIL to FTS_PROMOTE_FAIL--><path d="M457.9882,665.545 C477.9262,666.37 492.7962,670.188 492.7962,677 C492.7962,683.226 480.3722,686.951 463.0092,688.176 " fill="none" id="FTS_PROMOTE_FAIL-to-FTS_PROMOTE_FAIL" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="457.9882,688.455,467.1961,691.9499,462.9805,688.1778,466.7526,683.9622,457.9882,688.455" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31" x="512.7962" y="674.0669">retry</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="498.7962" y="689.1997">exhaused</text><!--MD5=[6e87ebf0501dfefe79d5cbf6f13b3bdd]
link FTS_PROMOTE_FAIL to *end--><path d="M402.9402,702.101 C432.2372,729.6366 478.8092,773.4067 499.6292,792.9746 " fill="none" id="FTS_PROMOTE_FAIL-to-*end" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="503.4372,796.5535,499.6185,787.4751,499.7938,793.1292,494.1397,793.3045,503.4372,796.5535" style="stroke:#0000FF;stroke-width:1.0;"/><!--MD5=[aa5f22ca8f78dc8d4b35ddb458338e52]
link FTS_PROBE_SUCCESS to FTS_PROMOTE_SEGMENT--><path d="M141.3652,651.887 C132.5022,643.519 124.0592,633.352 119.2962,622 C83.2347,536.057 102.462,422.001 114.693,369.162 " fill="none" id="FTS_PROBE_SUCCESS-to-FTS_PROMOTE_SEGMENT" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="115.8527,364.242,109.8923,372.0825,114.7042,369.1083,117.6784,373.9202,115.8527,364.242" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="120.2962" y="618.0669">retry promote</text><!--MD5=[a3f1ec13619904a5cc4d27763a95dc63]
@startuml
[*] - -> FTS_PROMOTE_SEGMENT : start PROMOTE
FTS_PROMOTE_SEGMENT -right[#blue]-> StateSocket
StateSocket -[#blue]-> FTS_PROMOTE_SUCCESS
StateSocket -[#blue]-> FTS_PROBE_SUCCESS : role is mirror
FTS_PROMOTE_SUCCESS -[#blue]-> [*]
StateSocket -[#blue]-> FTS_PROMOTE_FAIL : connect/send/receive failed
FTS_PROMOTE_FAIL -[#blue]-> FTS_PROMOTE_WAIT : retry_count++
FTS_PROMOTE_WAIT -[#blue]-> FTS_PROMOTE_SEGMENT
FTS_PROMOTE_FAIL -[#blue]-> FTS_PROMOTE_FAIL : retry \nexhaused
FTS_PROMOTE_FAIL -[#blue]-> [*]
FTS_PROBE_SUCCESS -[#blue]-> FTS_PROMOTE_SEGMENT : retry promote

state "Communicate with segment\n by libpq" as StateSocket {
  state "ftsConnect()" as long1
  long1 : "create libpq connection\n with segment"
  [*] - -> long1
  state "ftsPoll()" as poll
  state "update ftsInfo \nwith message" as update
  long1 -down-> poll
  poll - -> ftsSend : if write ready
  poll - -> ftsReceive : if read ready
  ftsReceive -down-> update
}
@enduml

PlantUML version 1.2021.4(Sun Apr 04 08:49:39 UTC 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>