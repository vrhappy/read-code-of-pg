<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="972px" preserveAspectRatio="none" style="width:1017px;height:972px;" version="1.1" viewBox="0 0 1017 972" width="1017px" zoomAndPan="magnify"><defs><filter height="300%" id="f1mhnc85bcpg9r" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="96" cy="16" fill="#000000" filter="url(#f1mhnc85bcpg9r)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><g id="FTS_PROBE_SEGMENT"><rect fill="#FEFECE" filter="url(#f1mhnc85bcpg9r)" height="64.2344" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="178" x="7" y="307"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7" x2="185" y1="333.2969" y2="333.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="158" x="17" y="324.9951">FTS_PROBE_SEGMENT</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="153" x="12" y="349.4355">a start state for fts probe</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="37" x="12" y="363.4043">ftsInfo</text></g><g id="FTS_PROBE_SUCCESS"><rect fill="#FEFECE" filter="url(#f1mhnc85bcpg9r)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="174" x="128" y="652"/><line style="stroke:#A80036;stroke-width:1.5;" x1="128" x2="302" y1="678.2969" y2="678.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="138" y="669.9951">FTS_PROBE_SUCCESS</text></g><g id="FTS_PROBE_FAIL"><rect fill="#FEFECE" filter="url(#f1mhnc85bcpg9r)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="139" x="745.5" y="314"/><line style="stroke:#A80036;stroke-width:1.5;" x1="745.5" x2="884.5" y1="340.2969" y2="340.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119" x="755.5" y="331.9951">FTS_PROBE_FAIL</text></g><g id="FTS_PROBE_WAIT"><rect fill="#FEFECE" filter="url(#f1mhnc85bcpg9r)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="146" x="599" y="652"/><line style="stroke:#A80036;stroke-width:1.5;" x1="599" x2="745" y1="678.2969" y2="678.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="609" y="669.9951">FTS_PROBE_WAIT</text></g><ellipse cx="975" cy="933" filter="url(#f1mhnc85bcpg9r)" rx="10" ry="10" style="stroke:#000000;stroke-width:1.0;fill:none;"/><ellipse cx="975.5" cy="933.5" fill="#000000" rx="6" ry="6" style="stroke:none;stroke-width:1.0;"/><g id="FTS_SYNCREP_OFF_SEGMENT"><rect fill="#FEFECE" filter="url(#f1mhnc85bcpg9r)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="229" x="398.5" y="908"/><line style="stroke:#A80036;stroke-width:1.5;" x1="398.5" x2="627.5" y1="934.2969" y2="934.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="209" x="408.5" y="925.9951">FTS_SYNCREP_OFF_SEGMENT</text></g><g id="FTS_PROMOTE_SEGMENT"><rect fill="#FEFECE" filter="url(#f1mhnc85bcpg9r)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="200" x="663" y="908"/><line style="stroke:#A80036;stroke-width:1.5;" x1="663" x2="863" y1="934.2969" y2="934.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="180" x="673" y="925.9951">FTS_PROMOTE_SEGMENT</text></g><rect fill="#FEFECE" filter="url(#f1mhnc85bcpg9r)" height="472.1875" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="239.5" x="293" y="103"/><rect fill="#FFFFFF" height="423.5938" rx="12.5" ry="12.5" style="stroke:#FFFFFF;stroke-width:1.0;" width="233.5" x="296" y="148.5938"/><line style="stroke:#A80036;stroke-width:1.5;" x1="293" x2="532.5" y1="145.5938" y2="145.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="203" x="311.25" y="120.9951">Communicate with segment</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="385.25" y="137.292">by libpq</text><g id="StateSocket.long1"><rect fill="#FEFECE" filter="url(#f1mhnc85bcpg9r)" height="64.2344" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="168" x="314" y="213.5938"/><line style="stroke:#A80036;stroke-width:1.5;" x1="314" x2="482" y1="239.8906" y2="239.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="352.5" y="231.5889">ftsConnect()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="148" x="319" y="256.0293">"create libpq connection</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="86" x="323" y="269.998">with segment"</text></g><ellipse cx="398" cy="166.5938" fill="#000000" filter="url(#f1mhnc85bcpg9r)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><g id="StateSocket.poll"><rect fill="#FEFECE" filter="url(#f1mhnc85bcpg9r)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="76" x="360" y="314.5938"/><line style="stroke:#A80036;stroke-width:1.5;" x1="360" x2="436" y1="340.8906" y2="340.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="370" y="332.5889">ftsPoll()</text></g><g id="StateSocket.update"><rect fill="#FEFECE" filter="url(#f1mhnc85bcpg9r)" height="52.5938" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="127" x="389.5" y="504.5938"/><line style="stroke:#A80036;stroke-width:1.5;" x1="389.5" x2="516.5" y1="547.1875" y2="547.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="399.5" y="522.5889">update ftsInfo</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="404" y="538.8857">with message</text></g><g id="StateSocket.ftsSend"><rect fill="#FEFECE" filter="url(#f1mhnc85bcpg9r)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="76" x="305" y="417.5938"/><line style="stroke:#A80036;stroke-width:1.5;" x1="305" x2="381" y1="443.8906" y2="443.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="315" y="435.5889">ftsSend</text></g><g id="StateSocket.ftsReceive"><rect fill="#FEFECE" filter="url(#f1mhnc85bcpg9r)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="97" x="404.5" y="417.5938"/><line style="stroke:#A80036;stroke-width:1.5;" x1="404.5" x2="501.5" y1="443.8906" y2="443.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="414.5" y="435.5889">ftsReceive</text></g><!--MD5=[dd6ad9b365bf2b3bdf74e95741d5e7fd]
link *start*StateSocket to long1--><path d="M398,176.7288 C398,184.6768 398,196.7338 398,208.4928 " fill="none" id="*start*StateSocket-to-long1" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="398,213.5007,402,204.5007,398,208.5007,394,204.5007,398,213.5007" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[ab72e750f024c3b94e0bda2ddbc5ba52]
link long1 to poll--><path d="M398,277.7408 C398,287.9508 398,299.2538 398,309.3208 " fill="none" id="long1-to-poll" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="398,314.4598,402,305.4598,398,309.4598,394,305.4598,398,314.4598" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[dfabde42eccabfe07b084b6028be8246]
link poll to ftsSend--><path d="M359.7891,363.1118 C353.437,368.6468 347.7158,375.1568 344,382.5938 C339.477,391.6468 338.2957,402.4978 338.5506,412.4108 " fill="none" id="poll-to-ftsSend" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="338.8047,417.4958,342.3523,408.308,338.5561,412.5019,334.3622,408.7057,338.8047,417.4958" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="345" y="395.6606">if write ready</text><!--MD5=[5f20784d7a0efc504bcbadc413bf6ea7]
link poll to ftsReceive--><path d="M419.229,365.0208 C423.467,370.5757 427.641,376.6097 431,382.5938 C436.288,392.0148 440.772,402.9557 444.284,412.8378 " fill="none" id="poll-to-ftsReceive" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="445.93,417.5928,446.7652,407.7794,444.2941,412.8679,439.2055,410.3968,445.93,417.5928" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="440" y="395.6606">if read ready</text><!--MD5=[a994e953120ce7c642eef577ec1770fd]
link ftsReceive to update--><path d="M453,467.6889 C453,477.4837 453,488.9211 453,499.3094 " fill="none" id="ftsReceive-to-update" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="453,504.313,457,495.313,453,499.313,449,495.313,453,504.313" style="stroke:#A80036;stroke-width:1.0;"/><g id="UpdateConfig"><rect fill="#FEFECE" filter="url(#f1mhnc85bcpg9r)" height="52.5938" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="146" x="476" y="794"/><line style="stroke:#A80036;stroke-width:1.5;" x1="476" x2="622" y1="836.5938" y2="836.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="494.5" y="811.9951">Update catalog</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="490" y="828.292">gp_configuration</text></g><!--MD5=[20f94ec43dd3c557b2bcc55578702ae0]
link *start to FTS_PROBE_SEGMENT--><path d="M96,26.261 C96,66.616 96,228.361 96,301.619 " fill="none" id="*start-to-FTS_PROBE_SEGMENT" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="96,306.737,100,297.737,96,301.737,92,297.737,96,306.737" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="97" y="69.0669">init ftsInfo</text><!--MD5=[c8e2aea650ffcf98c2191b913031a736]
link FTS_PROBE_SEGMENT to StateSocket--><path d="M185.146,339 C217,339 253.509,339 287.834,339 " fill="none" id="FTS_PROBE_SEGMENT-to-StateSocket" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="292.881,339,283.881,335,287.881,339,283.881,343,292.881,339" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="203.5" y="332.0669">start probe</text><!--MD5=[145d4df21e465dcd3db8f48517e62d58]
link StateSocket to FTS_PROBE_SUCCESS--><path d="M292.971,543.686 C268.812,584.683 246.405,622.707 231.869,647.373 " fill="none" id="StateSocket-to-FTS_PROBE_SUCCESS" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="229.248,651.821,237.263,646.0974,231.7862,647.5131,230.3704,642.0363,229.248,651.821" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[ecbf0a68488628e0ea9e07bee8578c2d]
link StateSocket to FTS_PROBE_FAIL--><path d="M533.069,339 C600.331,339 682.108,339 740.23,339 " fill="none" id="StateSocket-to-FTS_PROBE_FAIL" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="745.426,339,736.426,335,740.426,339,736.426,343,745.426,339" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="551.25" y="332.0669">connect/send/receive failed</text><!--MD5=[69d5fac5b265e50421ee28b586869738]
link FTS_PROBE_SUCCESS to FTS_PROBE_WAIT--><path d="M302.034,677 C386.166,677 512.481,677 593.577,677 " fill="none" id="FTS_PROBE_SUCCESS-to-FTS_PROBE_WAIT" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="598.852,677,589.852,673,593.852,677,589.852,681,598.852,677" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="320.5" y="670.0669">mirror is down but retryRequested=True</text><!--MD5=[ecd24f77485cd40dce3cc4b9ad1e750b]
link FTS_PROBE_SUCCESS to UpdateConfig--><path d="M277.15,702.101 C300.4,711.268 326.986,721.931 351,732 C397.127,751.341 448.808,774.222 487.8,791.734 " fill="none" id="FTS_PROBE_SUCCESS-to-UpdateConfig" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="492.492,793.842,485.9216,786.5051,487.9311,791.793,482.6432,793.8026,492.492,793.842" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="424" y="752.5669">no further state</text><!--MD5=[ecd24f77485cd40dce3cc4b9ad1e750b]
link FTS_PROBE_SUCCESS to UpdateConfig--><path d="M218.096,702.152 C221.928,721.801 230.405,748.696 249,764 C282.115,791.254 393.386,806.237 470.679,813.567 " fill="none" id="FTS_PROBE_SUCCESS-to-UpdateConfig-1" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="475.72,814.039,467.1317,809.2182,470.7417,813.5733,466.3866,817.1834,475.72,814.039" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="250" y="745.0669">mirror is down</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="260.5" y="760.1997">,close sync</text><!--MD5=[1f445195c96180bd8cee41373334ffda]
link UpdateConfig to *end--><path d="M622.232,840.496 C725.728,867.3414 908.047,914.6332 960.506,928.2405 " fill="none" id="UpdateConfig-to-*end" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="965.443,929.5211,957.736,923.3891,960.6032,928.2654,955.7269,931.1327,965.443,929.5211" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[1c0b40037759d352e2745717e0a76ebc]
link UpdateConfig to FTS_SYNCREP_OFF_SEGMENT--><path d="M540.65,847.129 C535.22,863.7957 528.127,885.5689 522.484,902.8887 " fill="none" id="UpdateConfig-to-FTS_SYNCREP_OFF_SEGMENT" style="stroke:#000000;stroke-width:2.0;"/><polygon fill="#000000" points="520.934,907.6477,527.5253,900.3296,522.4829,902.8937,519.9188,897.8513,520.934,907.6477" style="stroke:#000000;stroke-width:2.0;"/><!--MD5=[194cc6a82c4e881412ca8294373ec7c4]
link FTS_PROBE_FAIL to *end--><path d="M828.098,364.211 C855.208,415.558 917.327,539.876 946,652 C971.377,751.236 974.64,875.661 974.988,917.5136 " fill="none" id="FTS_PROBE_FAIL-to-*end" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="975.019,922.6418,978.9642,913.6176,974.9886,917.6419,970.9643,913.6663,975.019,922.6418" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="966" y="745.0669">double</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="975" y="760.1997">fault</text><!--MD5=[28db345a9ac58bfe7bdfbdeb6144a7c8]
link FTS_PROBE_FAIL to FTS_PROBE_WAIT--><path d="M802.352,364.339 C778.731,410.424 727.213,513.972 693,605 C687.93,618.49 683.273,633.783 679.639,646.711 " fill="none" id="FTS_PROBE_FAIL-to-FTS_PROBE_WAIT" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="678.248,651.725,684.5095,644.1228,679.5853,646.9072,676.8009,641.983,678.248,651.725" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="694" y="618.0669">retry_count++</text><!--MD5=[431325756377908d97a1f139e4639d42]
link FTS_PROBE_FAIL to UpdateConfig--><path d="M819.547,364.253 C830.028,428.13 848.832,602.889 763,702 C726.785,743.818 671.872,773.537 626.74,792.625 " fill="none" id="FTS_PROBE_FAIL-to-UpdateConfig" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="622.126,794.554,631.9724,794.7729,626.7391,792.6253,628.8866,787.392,622.126,794.554" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="822" y="674.0669">primary down</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="796" y="689.1997">,try to promote mirror</text><!--MD5=[bab02c5f423cd360945b4f9ff8ec7ec7]
link UpdateConfig to FTS_PROMOTE_SEGMENT--><path d="M598.634,847.129 C632.548,864.6403 677.378,887.7884 711.651,905.4859 " fill="none" id="UpdateConfig-to-FTS_PROMOTE_SEGMENT" style="stroke:#0000FF;stroke-width:2.0;"/><polygon fill="#0000FF" points="716.202,907.8357,710.0407,900.152,711.7594,905.5415,706.37,907.2602,716.202,907.8357" style="stroke:#0000FF;stroke-width:2.0;"/><!--MD5=[291739ddfc59fb8978b97f736a7f9687]
reverse link FTS_PROBE_SEGMENT to FTS_PROBE_WAIT--><path d="M113.356,375.892 C140.442,427.991 197.774,523.907 275,575 C374.646,640.926 514.48,663.821 598.842,671.771 " fill="none" id="FTS_PROBE_SEGMENT-backto-FTS_PROBE_WAIT" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="110.986,371.296,111.5564,381.1283,113.2779,375.7398,118.6665,377.4613,110.986,371.296" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[34dfc0bb2d9b2163d7328dfb8e15782b]
link FTS_PROBE_FAIL to FTS_PROBE_FAIL--><path d="M831.721,313.878 C868.283,271.893 919.5,280.267 919.5,339 C919.5,395.898 871.434,405.535 835.189,367.911 " fill="none" id="FTS_PROBE_FAIL-to-FTS_PROBE_FAIL" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="831.721,364.122,834.8501,373.4605,835.0981,367.8091,840.7496,368.0571,831.721,364.122" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31" x="939.5" y="336.0669">retry</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="925.5" y="351.1997">exhaused</text><!--MD5=[9664b2ed9bc53eabf37db206f8252a57]
@startuml
[*] - -> FTS_PROBE_SEGMENT : init ftsInfo
FTS_PROBE_SEGMENT -> StateSocket : start probe
StateSocket -down-> FTS_PROBE_SUCCESS
StateSocket -> FTS_PROBE_FAIL : connect/send/receive failed
FTS_PROBE_SEGMENT : a start state for fts probe
FTS_PROBE_SEGMENT : ftsInfo

state "Communicate with segment\n by libpq" as StateSocket {
  state "ftsConnect()" as long1
  long1 : "create libpq connection\n with segment"
  [*] - -> long1
  state "ftsPoll()" as poll
  state "update ftsInfo \nwith message" as update
  long1 -down-> poll
  poll - -> ftsSend : if write ready
  poll - -> ftsReceive : if read ready
  ftsReceive -down-> update
}

state "Update catalog\n gp_configuration" as UpdateConfig {

}

FTS_PROBE_SUCCESS -> FTS_PROBE_WAIT : mirror is down but retryRequested=True

FTS_PROBE_SUCCESS -> UpdateConfig : no further state
UpdateConfig - -> [*]

FTS_PROBE_SUCCESS -down[#black]-> UpdateConfig : mirror is down\n,close sync
UpdateConfig -down[#black,bold]-> FTS_SYNCREP_OFF_SEGMENT



FTS_PROBE_FAIL - -> [*] : double\n fault

FTS_PROBE_FAIL -down-> FTS_PROBE_WAIT : retry_count++
FTS_PROBE_FAIL -[#blue]> UpdateConfig : primary down\n,try to promote mirror
UpdateConfig -down[#blue,bold]-> FTS_PROMOTE_SEGMENT
FTS_PROBE_WAIT -up-> FTS_PROBE_SEGMENT
FTS_PROBE_FAIL -> FTS_PROBE_FAIL : retry \nexhaused
@enduml

PlantUML version 1.2021.4(Sun Apr 04 08:49:39 UTC 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>